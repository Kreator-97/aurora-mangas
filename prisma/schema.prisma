// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema
generator client {
  provider = "prisma-client-js"
  previewFeatures = ["fullTextSearch", "fullTextIndex"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id            String   @id @default(uuid())
  email         String   @unique
  fullname      String
  password      String
  imgURL        String?
  role          Role     @default(USER)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  provider      Provider @default(CREDENTIALS)
  orders        Order[]
  address       Address?
  subscriptions  Subscription[]
}

model Subscription {
  id                  String            @id @default(uuid())
  status              SubscriptionStatus
  user                User              @relation(fields: [userId], references: [id])
  userId              String            
  serie               Serie             @relation(fields: [serieId], references: [id])
  serieId             String
  date                DateTime          @default(now())
  paypalSuscriptionId String
}

enum SubscriptionStatus {
  ACTIVE
  PAUSED
  CANCELLED
}

model Address {
  id      String @id @default(uuid())
  state   String
  col     String
  city    String
  number  String
  cp      String
  user    User   @relation(fields: [userId], references: [id])
  userId  String @unique
}

enum Provider {
  GOOGLE
  CREDENTIALS
}

enum Role {
  ADMIN
  USER
}

model Author {
  id        String @id @default(uuid())
  name      String
  serie     Serie[]
}

model Serie {
  id            String      @id @default(uuid())
  author        Author      @relation(fields: [authorId], references: [id])
  authorId      String
  finished      Boolean
  genre         String
  imgURL        String
  name          String
  periodicy     Periodicy   @default(MENSUAL)
  sinopsis      String      @db.MediumText
  volumes       Manga[]
  isNewRelease  Boolean?
  slug          String      @unique
  totalVolumes  Int         @default(0)
  unitPrice     Int         @default(0)
  paypalPlanId  String?
  subscription   Subscription[]
}

model Manga {
  id        String  @id @default(uuid())
  serie     Serie   @relation(fields: [serieId], references: [id])
  serieId   String
  number    String
  price     Int
  imgURL    String
  published String
  title     String
  item      Item[]
  stock     Int     @default(0)
}

enum Periodicy {
  MENSUAL
  BIMESTRAL
}

model Order {
  id            String    @id @default(uuid())
  items         Item[]
  user          User      @relation(fields: [userId], references: [id])
  userId        String
  total         Int
  date          DateTime  @default(now())
  status        Status    @default(PENDING)
  transactionId String?
}

model Item {
  id        String  @id @default(uuid())
  order     Order   @relation(fields: [orderId], references: [id])
  orderId   String
  amount    Int
  product   Manga   @relation(fields: [productId], references: [id])
  productId String
}

enum Status {
  PAID
  PENDING
  CANCELLED
}
